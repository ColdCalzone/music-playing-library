<xml xmlns="https://developers.google.com/blockly/xml"><block type="pxt-on-start" id="u$Ls7eV.apcc@W5OY1|%" x="-395" y="2"><statement name="HANDLER"><block type="typescript_statement" id="j~nLw}.FuTf=LvIp`Iu." editable="false"><mutation xmlns="http://www.w3.org/1999/xhtml" line0="namespace music {" line1="    " line2="    //% block=&quot;play song $song at tempo $tempo&quot;" line3="    export function song_to_melody(song: string, tempo: number) {" line4="        let mode = 0" line5="        let offset = 0" line6="        let pos = 0" line7="        let newlines = 0" line8="        let line_length = 0" line9="" line10="        let letter: string;" line11="    " line12="        let melodies : string[] = []" line13="        let letters : string[] = []" line14="        while(song.indexOf(&quot;RH:&quot;) != -1) {" line15="            song = song.replace(&quot;RH:&quot;, &quot;&quot;)" line16="        }" line17="        while(song.indexOf(&quot;LH:&quot;) != -1) {" line18="            song = song.replace(&quot;LH:&quot;, &quot;&quot;)" line19="        }" line20="        //  ???? wtheck am i working with here???" line21="        while (song.indexOf(&quot;|&quot;) != -1) {" line22="            song = song.replace(&quot;|&quot;, &quot;&quot;)" line23="        }" line24="        while (song.indexOf(&quot; &quot;) != -1) {" line25="            song = song.replace(&quot; &quot;, &quot;&quot;)" line26="        }" line27="        line_length = song.indexOf(&quot;\n&quot;)" line28="        for (let i of song) {" line29="            if (i == &quot;\n&quot;) {" line30="                newlines += 1" line31="                if (newlines == 2) {" line32="                    pos += line_length" line33="                    newlines = 0" line34="                }" line35="            " line36="                offset = 0" line37="                continue" line38="            }" line39="        " line40="            if (i == &quot;&quot; + parseInt(i)) {" line41="                mode = parseInt(i)" line42="                if (newlines == 1) {" line43="                    newlines = 0" line44="                    offset = 0" line45="                }" line46="            " line47="            } else {" line48="                //  It seems like some completely normal methods are missing??? have to do this utter crap." line49="                letter = i" line50="                if (letter != &quot;-&quot;) {" line51="                    if (i.toLowerCase() != i) {" line52="                        letter = &quot;&quot; + letter + &quot;#&quot;" line53="                    }" line54="                " line55="                    // Python to TypeScript BUTCHERED this line" line56="                    if(mode &gt; 0) {" line57="                        letter = letter + mode" line58="                    } else {" line59="                        letter = letter + &quot;4&quot;" line60="                    }" line61="                }" line62="            " line63="                if (letters[pos + offset] == null || letters[pos + offset] == &quot;-&quot;) {" line64="                    letters[pos + offset] = letter" line65="                }" line66="            " line67="                offset += 1" line68="            }" line69="        " line70="        }" line71="" line72="        let melody = &quot;&quot;" line73="        let note_count = 0" line74="        note_count = 1" line75="        for (let x of letters) {" line76="            melody = &quot;&quot; + melody + x + &quot; &quot;" line77="            note_count += 1" line78="            if (note_count == 8) {" line79="                note_count = 0" line80="                melodies.push(melody)" line81="                melody = &quot;&quot;" line82="            }" line83="        " line84="        }" line85="        for (let lets_go of melodies) {" line86="            music.playMelody(lets_go, tempo)" line87="        }" line88="    }" line89="}" numlines="90"></mutation></block></statement></block><block type="pxt-on-start" id="*-O=6.|5P(0d?bpkTEWI" disabled="true" x="0" y="0"/></xml>